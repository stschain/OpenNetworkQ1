require("dotenv").config();
const axios = require("axios");

const piApiUrl = process.env.PI_NETWORK_API_URL;
const indodaxApiUrl = process.env.INDODAX_API_URL;
const privateKey = process.env.PI_PRIVATE_KEY;

// Fungsi untuk mencatat aktivitas transaksi Pi Network
async function recordTransactionOnPiNetwork(sender, receiver, amount) {
    try {
        const transactionData = {
            sender: sender,
            receiver: receiver,
            amount: amount,
            message: "Listing Pi Network on Indodax",
        };

        const response = await axios.post(`${piApiUrl}/transactions`, transactionData, {
            headers: {
                "Authorization": `Bearer ${privateKey}`,
                "Content-Type": "application/json",
            },
        });

        console.log("Pi Network Transaction Response:", response.data);
        return response.data;
    } catch (error) {
        console.error("Error in Pi Network transaction:", error.response ? error.response.data : error.message);
        throw error;
    }
}

// Fungsi untuk mencatat permintaan listing di Indodax
async function requestListingOnIndodax() {
    try {
        const response = await axios.post(`${indodaxApiUrl}/market_info`, {
            token: "Pi Network Token",
            symbol: "PI",
            message: "Request listing Pi Network on Indodax",
        });

        console.log("Indodax API Response:", response.data);
        return response.data;
    } catch (error) {
        console.error("Error in Indodax listing request:", error.response ? error.response.data : error.message);
        throw error;
    }
}

// Fungsi utama untuk menjalankan integrasi
async function integratePiWithIndodax() {
    try {
        const senderWallet = "PiWalletAddressSender"; // Ubah dengan alamat dompet asli
        const receiverWallet = "IndodaxWalletAddress"; // Ubah dengan alamat dompet tujuan di Indodax
        const amount = 1000; // Jumlah token yang akan ditransfer

        console.log("Initiating transaction on Pi Network...");
        await recordTransactionOnPiNetwork(senderWallet, receiverWallet, amount);

        console.log("Requesting listing on Indodax...");
        await requestListingOnIndodax();

        console.log("Integration successful.");
    } catch (error) {
        console.error("Integration failed:", error.message);
    }
}

// Jalankan fungsi integrasi
integratePiWithIndodax();
